<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheelie Life | Simulador Arcade de Física Detallado</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* --- Variables CSS (Paleta) --- */
        :root {
            --color-bg-deep: #121212; /* Negro muy profundo */
            --color-bg-section: #1F1F1F; /* Gris oscuro para contenido */
            --color-bg-nav: #292929; /* Gris medio para barra de navegación */
            --color-accent: #FFB300; /* Ámbar/Amarillo Anaranjado */
            --color-text-light: #E0E0E0;
            --color-text-dim: #A0A0A0;
            --color-border: #444444;
            --color-success: #66BB6A;
            --color-error: #EF5350;
            --color-info: #64B5F6;
        }

        /* --- Base General y Tipografía --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-deep);
            color: var(--color-text-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        a {
            color: var(--color-accent);
            text-decoration: none;
            transition: color 0.3s;
        }

        a:hover {
            color: #FFD54F;
        }

        /* --- Estructura Semántica (Nav/Header/Main) --- */
        nav {
            background-color: var(--color-bg-nav);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
            border-bottom: 2px solid var(--color-accent);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo {
            font-family: 'Press Start 2P', cursive;
            font-size: 1em;
            color: var(--color-accent);
        }

        .nav-links a {
            margin-left: 20px;
            font-weight: 600;
            color: var(--color-text-light);
            text-transform: uppercase;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .nav-links a:not(.active):hover {
            background-color: var(--color-bg-section);
            color: var(--color-accent);
        }

        .nav-links a.active {
            color: var(--color-bg-deep);
            background-color: var(--color-accent);
            box-shadow: 0 0 10px rgba(255, 179, 0, 0.7);
        }
        
        .nav-toggle { /* Botón de hamburguesa */
            display: none;
            font-size: 1.5em;
            background: none;
            border: none;
            color: var(--color-text-light);
            cursor: pointer;
        }

        header {
            text-align: center;
            padding: 100px 0 50px;
            background: linear-gradient(180deg, #1A1A1A 0%, #000000 100%);
            border-bottom: 1px solid var(--color-border);
        }

        .game-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 4em;
            color: var(--color-text-light);
            text-shadow: 0 0 8px rgba(255, 179, 0, 0.4);
            margin-bottom: 5px;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px 80px;
        }

        /* --- Lógica SPA: Ocultar/Mostrar Secciones --- */
        .content-section {
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 8px;
            background-color: var(--color-bg-section);
            border: 1px solid var(--color-border);
            display: none; 
            animation: fadeIn 0.5s ease-out;
        }

        .content-section.active {
            display: block; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2em;
            color: var(--color-accent);
            text-align: center;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        /* --- Elementos de Contenido --- */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .grid-item {
            padding: 20px;
            background-color: #2F2F2F;
            border-radius: 6px;
            border-left: 3px solid var(--color-accent);
        }

        .grid-item h3 {
            font-size: 1.1em;
            margin-top: 0;
            color: var(--color-text-light);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
            margin-top: 15px;
        }

        .stats-table th, .stats-table td {
            border-bottom: 1px solid var(--color-border);
            padding: 8px 0;
            font-size: 0.9em;
        }
        
        .stats-table th {
            color: var(--color-accent);
            font-weight: 600;
        }

        /* --- Estilos de Formularios (Login/Registro) --- */
        .form-container {
            max-width: 450px;
            margin: 20px auto;
            padding: 25px;
            background-color: #2F2F2F;
            border-radius: 6px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text-dim);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background-color: var(--color-bg-deep);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-text-light);
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 8px rgba(255, 179, 0, 0.5);
        }

        .form-btn {
            width: 100%;
            padding: 15px;
            background: var(--color-accent);
            color: var(--color-bg-deep);
            border-radius: 4px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }

        .form-btn:hover {
            background-color: #FFD54F;
        }

        /* --- Botones de Descarga por OS --- */
        .os-download-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .os-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 30px;
            background-color: #2F2F2F;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text-light);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .os-btn i {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .os-btn.enabled:hover {
            border-color: var(--color-accent);
            background-color: #3a3a3a;
            transform: translateY(-5px);
        }

        /* Estilo para el contador de descargas */
        .download-counter {
            margin-top: 8px;
            font-size: 0.8em;
            color: var(--color-text-dim);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .os-download-item {
            display: flex;
            flex-direction: column;
        }
        .os-btn.disabled {
            color: #666;
            cursor: not-allowed;
            position: relative;
        }

        .os-btn.disabled::after {
            content: 'Próximamente';
            position: absolute;
            bottom: 5px;
            font-size: 0.7em;
            color: #888;
        }

        /* --- Estilos de la Ventana Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none; /* Oculto por defecto */
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-bg-section);
            padding: 30px 40px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            position: relative;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 2.5em;
            cursor: pointer;
            color: var(--color-text-dim);
            transition: color 0.3s;
        }
        .modal-close-btn:hover { color: var(--color-text-light); }

        /* --- Footer --- */
        footer {
            padding: 30px;
            background-color: #000000;
            border-top: 2px solid var(--color-border);
            text-align: center;
            font-size: 0.85em;
            color: var(--color-text-dim);
        }

        /* --- Clases de Utilidad --- */
        .text-center { text-align: center; }
        .font-large { font-size: 1.1em; }
        .font-small { font-size: 0.9em; }
        .color-accent { color: var(--color-accent); }
        .color-dim { color: var(--color-text-dim); }
        .color-success { color: var(--color-success); }
        .color-error { color: var(--color-error); }
        .color-info { color: var(--color-info); }
        .fw-bold { font-weight: bold; }
        .fw-600 { font-weight: 600; }
        .mt-1 { margin-top: 10px; }
        .mt-2 { margin-top: 20px; }
        .mt-3 { margin-top: 30px; }

        /* --- Estilos del Foro --- */
        .comment-item {
            background-color: #2F2F2F;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-out;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        .comment-author {
            color: var(--color-accent);
            font-weight: bold;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8em;
        }
        .comment-date {
            color: var(--color-text-dim);
            font-size: 0.8em;
        }
        .comment-body {
            color: var(--color-text-light);
            white-space: pre-wrap; /* Respetar saltos de línea */
        }

        /* --- Media Queries para Diseño Adaptable --- */
        @media (max-width: 992px) {
            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background-color: var(--color-bg-nav);
                padding: 10px 0;
            }
            .nav-links.active { display: flex; }
            .nav-links a { margin: 5px 20px; text-align: center; }
            .nav-toggle { display: block; }
            #nav-auth-container, #nav-links-user { display: none !important; } /* Ocultar en el menú colapsado */
        }

        /* --- Estilos del Contador de Visitas --- */
        #visit-counter {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: var(--color-text-dim);
            padding: 5px 10px;
            font-size: 0.8em;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            .game-title { font-size: 2.5em; }
            header { padding: 60px 0 30px; }
            main { padding: 20px 10px 40px; }
            .content-section { padding: 20px; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- Contador de Visitas -->
    <div id="visit-counter">
        <i class="fas fa-eye"></i> Visitas: <span id="visit-count-number">0</span>
    </div>

    <nav>
        <div class="nav-container">
            <a href="#" class="nav-logo">WHEELIE LIFE</a>
            <div class="nav-links">
                <a href="#" data-target="download-content" class="active"><i class="fas fa-file-download"></i> Descarga</a>
                <a href="#" data-target="overview-content"><i class="fas fa-info-circle"></i> Visión General</a>
                <a href="#" data-target="documentation-content"><i class="fas fa-book-open"></i> Documentación Técnica</a>
                <a href="#" data-target="shop-content"><i class="fas fa-store"></i> Catálogo de Skins</a>
                <a href="#" data-target="changelog-content"><i class="fas fa-history"></i> Historial</a>
                <a href="#" data-target="forum-content"><i class="fas fa-comments"></i> Foro</a>
            </div>
            <button class="nav-toggle" id="nav-toggle-btn"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <header>
        <h1 class="game-title">WHEELIE LIFE</h1>
        <p class="tagline color-accent fw-600">¡Domina el equilibrio y conquista el asfalto!</p>
        <p class="version-display"><i class="fas fa-code-branch"></i> Versión Estable: <span id="game-version">1.1.1</span></p>
    </header>

    <main id="main-content-container">

        <section id="download-content" class="info-section content-section active">
            <h2 class="section-title">DESCARGA E INSTALACIÓN <i class="fas fa-arrow-down"></i></h2>
            <p class="text-center font-large">Obtén el juego completo en un archivo ZIP. Incluye el ejecutable (.exe) y todos los recursos necesarios. ¡Listo para jugar sin instalar Python!</p>
            
            <div class="os-download-container">
                <div class="os-download-item">
                    <a href="https://drive.google.com/uc?export=download&id=1HHuHpnFQYaJsHSHflcPOE11r12ByEO6n" id="windows-download-btn" class="os-btn enabled" download="WheelieLife_v1.1.1.zip">
                        <i class="fab fa-windows" style="color: #00A4EF;"></i>
                        <span>Windows (.exe)</span>
                    </a>
                    <div class="download-counter"><i class="fas fa-download"></i> Descargas: <span id="download-count-number">0</span></div>
                </div>
                <a href="#" class="os-btn disabled">
                    <i class="fab fa-linux" style="color: #FCC624;"></i>
                    <span>Linux</span>
                </a>
                <a href="#" class="os-btn disabled">
                    <i class="fab fa-apple" style="color: #A2AAAD;"></i>
                    <span>macOS</span>
                </a>
                <a href="#" class="os-btn disabled">
                    <i class="fab fa-android" style="color: #3DDC84;"></i>
                    <span>Android</span>
                </a>
            </div>
            
            <div class="grid-2 mt-3">
                <div class="grid-item">
                    <h3><i class="fas fa-box-open color-accent"></i> Contenido del Paquete</h3>
                    <ul style="list-style:none; padding:0;" class="color-dim">
                        <li><strong>WheelieLife.exe:</strong> El ejecutable principal del juego.</li>
                        <li><strong>_internal/:</strong> Carpeta con recursos del sistema (No tocar).</li>
                        <li><strong>assets/:</strong> Gráficos y sonidos.</li>
                    </ul>
                </div>
                <div class="grid-item">
                    <h3><i class="fas fa-check-circle color-accent"></i> Instrucciones de Instalación</h3>
                    <ol style="list-style:decimal; padding-left:20px;" class="color-dim">
                        <li>Descarga el archivo <strong>WheelieLife_v1.1.1.zip</strong>.</li>
                        <li>Descomprime el archivo en una carpeta de tu elección.</li>
                        <li>Entra en la carpeta descomprimida.</li>
                        <li>Haz doble clic en <strong>WheelieLife.exe</strong> (o Menu.exe) para iniciar.</li>
                    </ol>
                </div>
            </div>
        </section>
        
        <section id="overview-content" class="info-section content-section">
            <h2 class="section-title">VISIÓN GENERAL Y FILOSOFÍA DE JUEGO <i class="fas fa-info-circle"></i></h2>
            
            <div class="grid-3">
                <div class="grid-item">
                    <h3><i class="fas fa-balance-scale"></i> Jugabilidad: El Wheelie</h3>
                    <p>El núcleo del juego es mantener el equilibrio de la motocicleta en una rueda (*wheelie*). La inclinación constante y precisa es necesaria para compensar la aceleración y la gravedad.</p>
                </div>
                <div class="grid-item">
                    <h3><i class="fas fa-star"></i> Estilo Pixel Art Clásico</h3>
                    <p>El juego renderiza a una baja resolución interna de <strong>400x200 píxeles</strong> (escalada a <strong>1200x720</strong> en la ventana final), capturando la estética clásica de 16 bits.</p>
                </div>
                <div class="grid-item">
                    <h3><i class="fas fa-money-bill-wave"></i> Progresión y Economía</h3>
                    <p>La moneda se gana a razón de <strong>1$ por cada 10 metros</strong> recorridos. Este dinero es persistente (guardado en `player_data.json`) y se usa para desbloquear skins y mejoras permanentes.</p>
                </div>
            </div>

            <article class="mt-3" style="border-top: 1px solid var(--color-border); padding-top: 20px;">
                <h3 class="color-accent"><i class="fas fa-globe-americas"></i> Mundos y Distancia Máxima</h3>
                <p>El principal desafío es optimizar la velocidad y el arrastre para alcanzar la máxima distancia. Las skins con bonificaciones altas de `acceleration_bonus` y baja `drag_reduction` son clave para batir récords.</p>
                <p class="font-small color-dim">El récord de distancia (`max_distance`) se guarda en `player_data.json` y se actualiza al final de cada bucle de juego.</p>
            </article>
        </section>

        <section id="documentation-content" class="info-section content-section">
            <h2 class="section-title">DOCUMENTACIÓN TÉCNICA Y PARÁMETROS DE FÍSICA <i class="fas fa-book-open"></i></h2>
            
            <div class="grid-2">
                <div>
                    <h3><i class="fas fa-keyboard"></i> Controles del Juego</h3>
                    <p>El control del equilibrio es vital. Se recomienda práctica para dominar la inercia del piloto:</p>
                    <table class="stats-table">
                        <thead>
                            <tr><th>Tecla</th><th>Función</th><th>Detalles de Acción</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="color-accent fw-bold">D</td>
                                <td>Acelerar / Levantar</td>
                                <td>Acelera la moto y levanta la rueda delantera.</td>
                            </tr>
                            <tr>
                                <td class="color-accent fw-bold">W</td>
                                <td>Bloquear Ángulo</td>
                                <td>Mantiene el ángulo actual del wheelie para estabilizarlo.</td>
                            </tr>
                             <tr>
                                <td class="color-accent fw-bold">Opciones</td>
                                <td>Menú de Opciones</td>
                                <td>Ajusta el volumen de la música y los efectos de sonido.</td>
                            </tr>
                            <tr>
                                <td class="color-accent fw-bold">L</td>
                                <td>Logros</td>
                                <td>Abre el panel de logros durante el juego.</td>
                            </tr>
                            <tr>
                                <td class="color-accent fw-bold">ESC</td>
                                <td>Menú / Salir</td>
                                <td>Vuelve al menú principal o sale de las opciones.</td>
                            </tr>
                            <tr>
                                <td class="color-accent fw-bold">Flechas</td>
                                <td>Navegación</td>
                                <td>Moverse por los menús (Arriba/Abajo/Izq/Der).</td>
                            </tr>
                            <tr>
                                <td class="color-accent fw-bold">Enter</td>
                                <td>Seleccionar</td>
                                <td>Confirmar selección en menús.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <h3><i class="fas fa-trophy"></i> Logros Desbloqueables</h3>
                    <p>Supera estos desafíos para demostrar tu habilidad:</p>
                    <table class="stats-table">
                        <thead>
                            <tr><th>Logro</th><th>Descripción</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="color-success">Novato del Asfalto</td>
                                <td>Recorre 1.000 metros.</td>
                            </tr>
                            <tr>
                                <td class="color-success">Correcaminos</td>
                                <td>Recorre 5.000 metros.</td>
                            </tr>
                            <tr>
                                <td class="color-info">Velocista</td>
                                <td>Alcanza los 100 km/h.</td>
                            </tr>
                            <tr>
                                <td class="color-info">Bala Humana</td>
                                <td>Supera los 140 km/h.</td>
                            </tr>
                            <tr>
                                <td class="color-error">Bautismo de Fuego</td>
                                <td>Sufre tu primera caída.</td>
                            </tr>
                            <tr>
                                <td class="color-accent">Ahorrador</td>
                                <td>Acumula 1.000$ en total.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <article class="mt-3">
                <h3 class="color-accent"><i class="fas fa-cogs"></i> Constantes Físicas Clave</h3>
                <p>El juego simula la física con los siguientes parámetros base (sujetos a bonificaciones):</p>
                <table class="stats-table">
                    <thead>
                        <tr><th>Parámetro</th><th>Valor Base</th><th>Unidad</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>PIXELS_PER_METER</strong></td>
                            <td class="color-success">25.0</td>
                            <td>Píxeles/Metro</td>
                        </tr>
                        <tr>
                            <td><strong>ACELERACIÓN BASE</strong></td>
                            <td class="color-success">0.5</td>
                            <td>m/s (por frame)</td>
                        </tr>
                        <tr>
                            <td><strong>VELOCIDAD MÁXIMA</strong></td>
                            <td class="color-info">40.0</td>
                            <td>m/s (~144 km/h)</td>
                        </tr>
                        <tr>
                            <td><strong>ÁNGULO MÁXIMO</strong></td>
                            <td class="color-error">80.0</td>
                            <td>Grados</td>
                        </tr>
                    </tbody>
                </table>
            </article>
        </section>

        <section id="shop-content" class="info-section content-section">
            <h2 class="section-title">CATÁLOGO DE SKINS Y BONIFICACIONES <i class="fas fa-store"></i></h2>
            <p class="text-center color-dim">Cada skin ofrece una combinación única de estadísticas. Las bonificaciones se aplican como multiplicadores sobre la física base.</p>
            <div id="dynamic-list" class="grid-3 mt-2">
                </div>
        </section>

        <section id="changelog-content" class="info-section content-section">
            <h2 class="section-title">HISTORIAL DE VERSIONES <i class="fas fa-history"></i></h2>
            <div id="changelog-container">
            </div>
        </section>

        <section id="forum-content" class="info-section content-section">
            <h2 class="section-title">FORO DE LA COMUNIDAD <i class="fas fa-comments"></i></h2>
            <p class="text-center color-dim">Comparte tus récords, sugiere ideas o reporta bugs. ¡Tu opinión nos ayuda a mejorar!</p>
            
            <div class="form-container" style="max-width: 600px;">
                <form id="forum-form">
                    <div class="form-group">
                        <label for="forum-author">Nombre de Usuario</label>
                        <input type="text" id="forum-author" placeholder="Tu nombre..." required maxlength="20">
                    </div>
                    <div class="form-group">
                        <label for="forum-text">Comentario</label>
                        <textarea id="forum-text" rows="4" placeholder="Escribe tu comentario aquí..." required style="width: 100%; padding: 12px; background-color: var(--color-bg-deep); border: 1px solid var(--color-border); border-radius: 4px; color: var(--color-text-light); font-family: 'Inter', sans-serif; resize: vertical;"></textarea>
                    </div>
                    <button type="submit" class="form-btn"><i class="fas fa-paper-plane"></i> Publicar Comentario</button>
                </form>
            </div>

            <div id="comments-list" class="mt-3">
                <!-- Los comentarios se cargarán aquí dinámicamente -->
            </div>
        </section>
    </main>


    <script>
        // --- 1. DATOS DEL JUEGO (Extraídos de player.py) ---
        const CURRENT_GAME_VERSION = "1.1.1"; 
        
        const GAME_DATA = {
            "skins": {
                 "negro": {"price": 0, "name": "Negro Básico", "acceleration_bonus": 1.0, "top_speed_bonus": 0.0, "drag_reduction": 1.0},
                 "rojo": {"price": 500, "name": "Rojo Furia", "acceleration_bonus": 1.1, "top_speed_bonus": 2.0, "drag_reduction": 1.0},
                 "verde": {"price": 750, "name": "Verde Neón", "acceleration_bonus": 1.0, "top_speed_bonus": 0.0, "drag_reduction": 0.9},
                 "azul": {"price": 1000, "name": "Azul Eléctrico", "acceleration_bonus": 1.15, "top_speed_bonus": 4.0, "drag_reduction": 0.95},
                 "dorado": {"price": 2500, "name": "Dorado Real", "acceleration_bonus": 1.2, "top_speed_bonus": 5.0, "drag_reduction": 0.9},
                 "carbono": {"price": 1800, "name": "Fibra Carbono", "acceleration_bonus": 1.0, "top_speed_bonus": 8.0, "drag_reduction": 1.0},
                 "fantasma": {"price": 3000, "name": "Blanco Fantasma", "acceleration_bonus": 1.3, "top_speed_bonus": 3.0, "drag_reduction": 0.85},
                 "rosa": {"price": 400, "name": "Rosa Chicle", "acceleration_bonus": 1.05, "top_speed_bonus": 1.0, "drag_reduction": 1.0},
                 "naranja": {"price": 600, "name": "Naranja Atómico", "acceleration_bonus": 1.12, "top_speed_bonus": 1.5, "drag_reduction": 0.98}
            },
            "worlds": ["Pradera", "Desierto", "Nieve"]
        };

        const CHANGELOG_DATA = [
            {
                version: "1.1.1",
                date: "13/12/2025",
                features: [
                    "Nuevo Sistema de Menús: Navegación completa con teclado (Flechas + Enter).",
                    "Tienda Visual: Nueva interfaz gráfica para comprar y equipar skins.",
                    "Panel de Opciones: Ajuste de volumen de música y efectos de sonido.",
                    "Selección de Mundos: Elige entre Pradera, Desierto y Nieve antes de empezar.",
                    "Paginación en la Tienda: Navega por el catálogo de skins con páginas.",
                    "Nuevas Skins: Se han añadido 5 skins nuevas al catálogo."
                ]
            },
            {
                version: "1.1.0",
                date: "10/12/2025",
                features: [
                    "Estructura de guardado: Implementación de la clave 'money' en el archivo `data.json` para evitar errores al cargar.",
                    "Física: Ajuste del coeficiente de resistencia del aire (DRAG_COEFFICIENT=0.006) para mayor realismo a alta velocidad.",
                    "Gráficos: Mejora en el renderizado del Parallax del fondo."
                ]
            },
            {
                version: "1.0.0",
                date: "08/12/2025",
                features: [
                    "Lanzamiento inicial con el sistema de física de inclinación.",
                    "Sistema de economía: Gana 1$ por cada 10 metros recorridos."
                ]
            }
        ];

        // --- 3. LÓGICA DE NAVEGACIÓN (SPA) ---
        function showSection(sectionId) {
            // 1. Ocultar todas las secciones de contenido
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // 2. Mostrar la sección deseada y actualizar enlaces
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
            }

            // 3. Actualizar el estado activo en los enlaces de navegación
            document.querySelectorAll('.nav-links a[data-target]').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-target') === sectionId) {
                    link.classList.add('active');
                }
            });
        }

        // --- 6. FUNCIONES DE RENDERIZADO DE CONTENIDO ---

        function renderSkinItem(key, skinData) {
            const statusText = key === 'negro' ? 'Skin Base' : `Precio: $${skinData.price}`;
            
            // Función para formatear bonificaciones
            const formatBonus = (val, type) => {
                let color = '#E0E0E0';
                let text;

                if (type === 'speed_bonus') {
                    // Bonificación absoluta de velocidad máxima
                    color = 'var(--color-success)';
                    text = `+${val.toFixed(1)} km/h`;
                } else if (val > 1.0) {
                    // Bonificación porcentual positiva (Aceleración)
                    color = 'var(--color-success)';
                    text = `+${((val - 1) * 100).toFixed(0)}%`;
                } else if (val < 1.0) {
                    // Bonificación de reducción (Arrastre)
                    color = 'var(--color-info)';
                    text = `x${val.toFixed(2)}`;
                } else {
                    // Neutral
                    color = '#A0A0A0';
                    text = 'x1.0';
                }
                
                return `<span style="color:${color}; font-weight: 600;">${text}</span>`;
            };

            return `
                <div class="grid-item skin-card">
                    <h3 class="color-accent"><i class="fas fa-motorcycle"></i> ${skinData.name}</h3>
                    <p class="color-dim font-small" style="margin-top:-10px;">(${statusText})</p>
                    <ul style="list-style:none; padding:0;" class="font-small">
                        <li><i class="fas fa-bolt color-success"></i> Acel. Multiplicador: ${formatBonus(skinData.acceleration_bonus, 'accel_bonus')}</li>
                        <li><i class="fas fa-angle-double-up color-info"></i> Vel. Máx. Adicional: ${formatBonus(skinData.top_speed_bonus, 'speed_bonus')}</li>
                        <li><i class="fas fa-wind color-info"></i> Arrastre (Coef. Multi.): ${formatBonus(skinData.drag_reduction, 'drag_reduction')}</li>
                    </ul>
                </div>
            `;
        }

        function renderChangelogItem(log) {
            const featuresList = log.features.map(f => `<li><i class="fas fa-caret-right color-success"></i> ${f}</li>`).join('');
            
            return `
                <div class="changelog-item">
                    <h4><i class="fas fa-calendar-alt color-accent"></i> V${log.version} - ${log.date}</h4>
                    <ul style="list-style:none; padding-left: 10px;" class="color-dim">
                        ${featuresList}
                    </ul>
                </div>
            `;
        }

        // --- Función para el contador de visitas ---
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        async function updateVisitCounter() {
            const namespace = 'wheelie-life-game'; // Un nombre único para tu proyecto
            const key = 'unique-visitors';       // La clave que quieres contar
            const counterElement = document.getElementById('visit-count-number');

            // 1. Comprobar si este navegador ya ha sido contado (usando cookies)
            if (!getCookie('hasVisitedWheelieLife')) {
                // Si es la primera vez, marca como visitado y registra el "hit"
                setCookie('hasVisitedWheelieLife', 'true', 365);
                // Incrementa el contador en el servicio externo
                try {
                    await fetch(`https://api.counterapi.dev/v1/${namespace}/${key}/up`);
                } catch (e) { console.error(e); }
            }

            // 2. Obtener el total de visitas y mostrarlo
            try {
                const response = await fetch(`https://api.counterapi.dev/v1/${namespace}/${key}`);
                const data = await response.json();
                if (counterElement) counterElement.textContent = data.count || 0;
            } catch (error) {
                if (counterElement) counterElement.textContent = 'N/A';
                console.error("Error al obtener el contador de visitas:", error);
            }
        }

        // --- Función para el contador de descargas ---
        async function updateDownloadCounter() {
            const namespace = 'wheelie-life-game';
            const key = 'windows-downloads';
            const counterElement = document.getElementById('download-count-number');
            
            // Solo obtiene y muestra el valor actual
            try {
                const response = await fetch(`https://api.counterapi.dev/v1/${namespace}/${key}`);
                const data = await response.json();
                if (counterElement) counterElement.textContent = data.count || 0;
            } catch (error) { 
                if (counterElement) counterElement.textContent = 'N/A';
            }
        }

        async function handleDownloadClick(event) {
            event.preventDefault(); // 1. Evita que el enlace funcione por defecto
            const downloadUrl = event.currentTarget.href;
            const namespace = 'wheelie-life-game';
            const key = 'windows-downloads';
            const counterElement = document.getElementById('download-count-number');

            try {
                // 2. Llama a la API para incrementar y espera la respuesta
                const response = await fetch(`https://api.counterapi.dev/v1/${namespace}/${key}/up`);
                const data = await response.json();
                if (counterElement) counterElement.textContent = data.count; // 3. Actualiza la UI
            } catch (e) {
                console.error(e);
            } finally {
                // 4. Inicia la descarga, incluso si la API falló
                window.location.href = downloadUrl;
            }
        }
        
        // --- 8. LÓGICA DEL FORO (LOCALSTORAGE) ---
        function loadComments() {
            const comments = JSON.parse(localStorage.getItem('game_comments') || '[]');
            const container = document.getElementById('comments-list');
            
            if (comments.length === 0) {
                container.innerHTML = '<p class="text-center color-dim">Aún no hay comentarios. ¡Sé el primero!</p>';
                return;
            }

            container.innerHTML = comments.map(c => `
                <div class="comment-item">
                    <div class="comment-header">
                        <span class="comment-author">${c.author}</span>
                        <span class="comment-date">${c.date}</span>
                    </div>
                    <p class="comment-body">${c.text}</p>
                </div>
            `).join('');
        }

        function addComment(author, text) {
            // Sanitización básica para evitar inyección de HTML
            const safeAuthor = author.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const safeText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");

            const comments = JSON.parse(localStorage.getItem('game_comments') || '[]');
            const newComment = {
                author: safeAuthor,
                text: safeText,
                date: new Date().toLocaleString()
            };
            comments.unshift(newComment); // Añadir al principio
            localStorage.setItem('game_comments', JSON.stringify(comments));
            loadComments();
        }

        // --- 7. INICIALIZACIÓN Y EVENTOS ---
        document.addEventListener('DOMContentLoaded', () => {
            // Renderizar contenido dinámico (skins y changelog)
            const skinContainer = document.getElementById('dynamic-list');
            if (skinContainer) {
                const skinsHtmlArray = Object.keys(GAME_DATA.skins).map(key => renderSkinItem(key, GAME_DATA.skins[key]));
                skinContainer.innerHTML = skinsHtmlArray.join('');
            }
            
            const changelogContainer = document.getElementById('changelog-container');
            if (changelogContainer) {
                const changelogHtmlArray = CHANGELOG_DATA.map(log => renderChangelogItem(log));
                changelogContainer.innerHTML = changelogHtmlArray.join('');
            }

            // Cargar comentarios del foro
            loadComments();

            // Evento para el formulario del foro
            const forumForm = document.getElementById('forum-form');
            if (forumForm) {
                forumForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const author = document.getElementById('forum-author').value;
                    const text = document.getElementById('forum-text').value;
                    
                    if (author && text) {
                        addComment(author, text);
                        forumForm.reset();
                        alert('¡Comentario publicado!');
                    }
                });
            }
            
            // Asignar eventos de click a la navegación
            document.querySelectorAll('nav a[data-target]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    if (targetId) {
                        showSection(targetId);
                    }
                });
            });
            
            // --- Evento para el menú de hamburguesa ---
            document.getElementById('nav-toggle-btn').addEventListener('click', () => {
                document.querySelector('.nav-links').classList.toggle('active');
                // Ocultar los botones de auth/user si el menú principal se abre en móvil
                // (ya que no están dentro del menú colapsable)
            });

            // --- Evento para el botón de descarga de Windows ---
            document.getElementById('windows-download-btn').addEventListener('click', handleDownloadClick); // Corregido para usar solo un manejador

            // Estado inicial de la UI al cargar la página
            showSection('download-content');
            updateVisitCounter();
            updateDownloadCounter(); // Cargar el contador de descargas inicial
        });
    </script>
</body>
</html>
